;//////////////////////////////////////////////////////////////////////
;/// This file is subject to the terms and conditions defined in    ///
;/// file 'LICENSE.txt', which is part of this source code package. ///
;//////////////////////////////////////////////////////////////////////
[SEGMENT .text]

    ;////////////////////////////////////////////////////
    ;/// Define all modules includes
    ;////////////////////////////////////////////////////
    %include 'src/foundation/Foundation_Module_Speedhack.asm'

;////////////////////////////////////////////////////
;///!< The original callback
;////////////////////////////////////////////////////
__fRealSendData          DD 0x00000000

;////////////////////////////////////////////////////
;/// \brief Initialize foundation enviroment
;////////////////////////////////////////////////////
InitializeFoundation:
    PUSH EBP
    MOV  EBP, ESP
    
    ;////////////////////////////////////////////////////
    ;/// Initialize SpeedHACK module
    ;////////////////////////////////////////////////////
    CALL InitializeSpeedhackModule
    
    ;////////////////////////////////////////////////
    ;/// Redirect "SendData" for our function
    ;////////////////////////////////////////////////
    PUSH MySendData
    PUSH 0x005878A0
    CALL WriteDetour
    MOV  DWORD [__fRealSendData], EAX
    
    ;////////////////////////////////////////////////
    ;/// Redirect "HandleData" for our function
    ;////////////////////////////////////////////////
    ; <TODO>

    MOV  ESP, EBP
    POP  EBP
    RET

;////////////////////////////////////////////////////
;/// \brief Send data to the server
;///
;/// \param ????
;/// \param ????
;////////////////////////////////////////////////////
MySendData:
    PUSH EBP
    MOV  EBP, ESP

    ;// Execute the real callback
    PUSH DWORD [EBP + 0x0C]
    PUSH DWORD [EBP + 0x08]
    CALL DWORD [__fRealSendData] 

    MOV  ESP, EBP
    POP  EBP
    RET  0x08